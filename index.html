<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leisnig Aktuell</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    header { background: #4b0082; color: white; padding: 1rem; text-align: center; }
    section { padding: 1rem; }
    h2 { color: #4b0082; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
    .card { background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .images img { width: 100%; border-radius: 10px; margin-bottom: 1rem; object-fit: cover; display: block; }
  </style>
</head>
<body>
  <header>
    <h1>Leisnig – Tagesaktuell</h1>
  </header>

  <section class="images">
    <h2>Bilder aus Leisnig</h2>
    <div class="grid" id="image-gallery">Lade Bilder...</div>
  </section>

  <section>
    <h2>Aktuelle Nachrichten (MDR Sachsen)</h2>
    <div id="news" class="grid">Lade News...</div>
  </section>

  <section>
    <h2>Veranstaltungen – Kulturbahnhof</h2>
    <div id="events-kultur" class="grid">Lade Veranstaltungen...</div>
  </section>

  <section>
    <h2>Veranstaltungen – Stadt Leisnig</h2>
    <div id="events-stadt" class="grid">Lade Veranstaltungen...</div>
  </section>

  <script>
    const images = [
      {src: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Leisnig_und_Burg_Mildenstein.jpg/330px-Leisnig_und_Burg_Mildenstein.jpg', alt: 'Burg Mildenstein'},
      {src: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Lei%C3%9Fnigk_%28Merian%29.jpg/250px-Lei%C3%9Fnigk_%28Merian%29.jpg', alt: 'Altes Leisnig'},
      {src: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/79/Leising_-_Rathaus_%2802-2%29.jpg/250px-Leising_-_Rathaus_%2802-2%29.jpg', alt: 'Rathaus Leisnig'},
      {src: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Leisnig%2C_st-matth%C3%A4i_church_-_de.jpg/250px-Leisnig%2C_st-matth%C3%A4i_church_-_de.jpg', alt: 'Kirche Leisnig'}
    ];

    function loadImages() {
      const gallery = document.getElementById('image-gallery');
      gallery.innerHTML = images.map(img => `<div class="card"><img src="${img.src}" alt="${img.alt}"></div>`).join('');
    }

    async function fetchWithCors(url) {
      try {
        const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
        const data = await res.json();
        return data.contents;
      } catch(e) {
        console.error('Fetch Fehler:', e);
        return '';
      }
    }

    async function loadRSS() {
      const contents = await fetchWithCors('https://www.mdr.de/nachrichten/sachsen/index-rss.xml');
      if (!contents) return;
      const doc = new DOMParser().parseFromString(contents, 'text/xml');
      const items = doc.querySelectorAll('item');
      const html = Array.from(items).slice(0,6).map(item => `
        <div class="card">
          <a href="${item.querySelector('link').textContent}" target="_blank">
            ${item.querySelector('title').textContent}
          </a>
        </div>
      `).join('');
      document.getElementById('news').innerHTML = html;
    }

   async function loadKulturEvents() {
  const contents = await fetchWithCors('https://bahnhof-leisnig.de/konzerte-veranstaltungen/');
  if (!contents) return;
  const doc = new DOMParser().parseFromString(contents, 'text/html');
  
  // Alle Veranstaltungstitel und Daten erfassen
  const eventElems = doc.querySelectorAll('.tribe-events-calendar-list__event-title, .tribe-events-list-event-title, .tribe-events-event-title, h3, h4');
  const dateElems = doc.querySelectorAll('.tribe-event-date-start, .tribe-events-event-date-start, time');

  let events = [];
  for(let i = 0; i < eventElems.length; i++){
    const title = eventElems[i]?.textContent.trim();
    const date = dateElems[i]?.textContent.trim() || '';
    if(title) events.push(`${date} — ${title}`);
  }

  if(events.length === 0) events.push('Keine Veranstaltungen gefunden oder Webseite lädt dynamisch.');
  
  document.getElementById('events-kultur').innerHTML = events.map(ev => `<div class="card">${ev}</div>`).join('');
}

    async function loadStadtEvents() {
      const contents = await fetchWithCors('https://www.leisnig.de/veranstaltungen');
      if (!contents) return;
      const doc = new DOMParser().parseFromString(contents, 'text/html');
      let events = [];
      const articles = doc.querySelectorAll('article, .veranstaltung');
      if (articles.length > 0) {
        articles.forEach(a => {
          const title = a.querySelector('h2, h3')?.textContent || '';
          const date = a.querySelector('.datum, time')?.textContent || '';
          if(title) events.push(`${date} — ${title}`);
        });
      } else {
        const elems = doc.querySelectorAll('h2, h3');
        let currentDate = '';
        elems.forEach(el => {
          if (el.tagName === 'H2') currentDate = el.textContent.trim();
          else if (el.tagName === 'H3' && currentDate) events.push(`${currentDate} — ${el.textContent.trim()}`);
        });
      }
      if(events.length === 0) events.push('Keine Veranstaltungen gefunden oder Webseite lädt dynamisch.');
      document.getElementById('events-stadt').innerHTML = events.slice(0,6).map(t => `<div class="card">${t}</div>`).join('');
    }

    loadImages();
    loadRSS();
    loadKulturEvents();
    loadStadtEvents();
  </script>
</body>
</html>



